#!/usr/bin/env bash
#this scrip instal an confugure a load balacer HAProxy.
apt-get update
apt-get -y install haproxy=1.6.\*

echo "ENABLED=1" >> /etc/default/haproxy
echo "frontend firstbalance" >> /etc/haproxy/haproxy.cfg
echo "        bind *:80" >> /etc/haproxy/haproxy.cfg
echo "        option forwardfor" >> /etc/haproxy/haproxy.cfg
echo "        default_backend webservers" >> /etc/haproxy/haproxy.cfg

echo "backend webservers" >> /etc/haproxy/haproxy.cfg
echo "        balance roundrobin" >> /etc/haproxy/haproxy.cfg
echo "        server 1526-web-01 35.185.14.17:80:80" >> /etc/haproxy/haproxy.cfg
echo "        server 1526-web-02 34.73.91.94:80" >> /etc/haproxy/haproxy.cfg
echo "        server 1526-web-01 35.185.14.17:80 check" >> /etc/haproxy/haproxy.cfg
echo "        server 1526-web-02 34.73.91.94:80 check" >> /etc/haproxy/haproxy.cfg 
echo "        option httpchk" >> /etc/haproxy/haproxy.cfg
sudo service haproxy restart
